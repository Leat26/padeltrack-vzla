<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>PADELTRACK</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reset y variables */
    :root {
      --primary: #016B3A;
      --primary-dark: #00552E;
      --secondary: #E3F2FD;
      --text: #333;
      --text-light: #666;
      --border: #ddd;
      --success: #4CAF50;
      --error: #F44336;
      --vh: 1vh;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f5f5f5;
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      touch-action: manipulation;
    }
    
    .container {
      height: calc(var(--vh, 1vh) * 100);
      position: relative;
      overflow: hidden;
      background: white;
    }
    
    /* Estructura de pantallas */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px;
      display: none;
      flex-direction: column;
      overflow-y: auto;
    }
    
    .screen.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Header */
    header {
      text-align: center;
      padding: 15px 0;
      margin-bottom: 20px;
      cursor: pointer;
      user-select: none;
    }
    
    header i {
      color: var(--primary);
      font-size: 24px;
      margin-right: 8px;
    }
    
    header h1 {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary);
    }
    
    /* Formularios */
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text);
    }
    
    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(1, 107, 58, 0.2);
    }
    
    /* Botones */
    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px 0;
      text-align: center;
    }
    
    .btn-blue {
      background: var(--primary);
      color: white;
    }
    
    .btn-blue:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: rgba(1, 107, 58, 0.05);
    }
    
    /* Notificación */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: white;
      padding: 12px 25px;
      border-radius: 30px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .notification.show {
      opacity: 1;
    }
    
    /* Pantalla de inicio */
    #home h2 {
      font-size: 22px;
      margin-bottom: 10px;
      color: var(--primary);
    }
    
    #home p {
      color: var(--text-light);
      margin-bottom: 15px;
    }
    
    #home .courts-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    
    /* Pantalla de bienvenida */
    .welcome-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }
    
    #welcome h2 {
      font-size: 28px;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    #welcome .subtitle {
      color: var(--text-light);
      margin-bottom: 25px;
      font-size: 18px;
    }
    
    .handshake-container {
      background: white;
      border-radius: 20px;
      padding: 15px;
      display: inline-block;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin: 20px 0;
    }
    
    .handshake-img {
      width: 180px;
      height: auto;
      border-radius: 12px;
      transition: transform 0.3s ease;
    }
    
    .handshake-img:hover {
      transform: scale(1.05);
    }
    
    .btn-green {
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px 28px;
      margin: 20px 0;
      font-size: 18px;
      border-radius: 14px;
      cursor: pointer;
      width: 85%;
      max-width: 320px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(1, 107, 58, 0.3);
      transition: all 0.3s ease;
    }
    
    .btn-green:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    /* Alertas */
    .alert {
      background: #fff8e1;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
      color: #5d4037;
    }
    
    .alert i {
      margin-right: 8px;
    }
    
    /* Validación de cédula */
    .cedula-validation {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 16px;
    }
    
    .cedula-validation i {
      transition: all 0.3s ease;
    }
    
    .cedula-validation.valid i {
      color: var(--success);
    }
    
    .cedula-validation.invalid i {
      color: var(--error);
    }
    
    .cedula-validation.loading i {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Estado del jugador */
    .player-status {
      font-size: 12px;
      color: var(--text-light);
      text-align: center;
      margin-top: 5px;
      min-height: 18px;
    }
    
    /* Pantalla de registro */
    .player-form {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .player-form h3 {
      margin-bottom: 15px;
      color: var(--primary);
      text-align: center;
    }
    
    .player-form .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .form-row .form-control {
      flex: 1;
    }
    
    /* Marcador */
    .scoreboard {
      display: flex;
      justify-content: space-between;
      background: #f5f5f5;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .team {
      text-align: center;
      flex: 1;
    }
    
    .team-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text);
    }
    
    .score {
      font-size: 36px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .games {
      font-size: 24px;
      margin-top: 5px;
    }
    
    .tiebreak {
      font-size: 18px;
      color: var(--text-light);
      margin-top: 5px;
    }
    
    /* Botones de marcador */
    .score-controls {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .score-btn {
      padding: 12px;
      font-size: 16px;
    }
    
    .timer {
      text-align: center;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-light);
    }
    
    /* Ranking */
    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .ranking-rank {
      font-weight: bold;
      color: var(--primary);
      min-width: 24px;
    }
    
    .win-percentage {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .ranking-wins {
      color: var(--success);
      font-weight: bold;
    }
    
    .ranking-losses {
      color: var(--error);
    }
    
    /* Dashboard */
    .dashboard-stats {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      margin: 10px 0;
    }
    
    .stat-label {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .top-players {
      margin-bottom: 25px;
    }
    
    .player-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .player-rank {
      font-weight: bold;
      color: var(--primary);
      min-width: 20px;
    }
    
    .canchas-usage {
      height: 200px;
      background: #f9f9f9;
      border-radius: 12px;
      padding: 15px;
      margin-top: 10px;
    }
    
    /* Ajustes específicos para pantallas */
    #login, #register-screen, #welcome {
      justify-content: center;
    }
    
    .form-container {
      max-width: 400px;
      width: 100%;
      margin: 0 auto;
    }
    
    .login-options {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
      .courts-container {
        grid-template-columns: 1fr;
      }
      
      .score-controls {
        grid-template-columns: 1fr 1fr 1fr;
      }
      
      .dashboard-stats {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Notificación -->
    <div class="notification" id="notification"></div>
    
    <!-- Pantalla 1: Login -->
    <div class="screen" id="login">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <div class="form-container">
        <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary);">Iniciar Sesión</h2>
        <div class="form-group">
          <label for="login-email">Correo Electrónico</label>
          <input type="email" class="form-control" id="login-email" placeholder="tu@correo.com">
        </div>
        <div class="form-group">
          <label for="login-password">Contraseña</label>
          <input type="password" class="form-control" id="login-password" placeholder="Contraseña">
        </div>
        <button class="btn btn-blue" onclick="window.loginUser()">Iniciar Sesión</button>
        <div style="text-align: center; margin-top: 20px;">
          <p>¿No tienes cuenta? <a href="#" style="color: var(--primary); text-decoration: none;" onclick="window.goToScreen('register-screen')">Regístrate</a></p>
        </div>
      </div>
    </div>
    
    <!-- Pantalla 2: Registro de Club -->
    <div class="screen" id="register-screen">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <div class="form-container">
        <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary);">Registro de Club</h2>
        <div class="form-group">
          <label for="club-name">Nombre del Club</label>
          <input type="text" class="form-control" id="club-name" placeholder="Nombre de tu club">
        </div>
        <div class="form-group">
          <label for="club-rif">RIF del Club</label>
          <input type="text" class="form-control" id="club-rif" placeholder="Ej: J-12345678-9">
        </div>
        <div class="form-group">
          <label for="court-count">Cantidad de Canchas</label>
          <input type="number" class="form-control" id="court-count" min="1" max="20" value="1">
        </div>
        <div class="form-group">
          <label for="phone-number">Teléfono de Contacto</label>
          <input type="tel" class="form-control" id="phone-number" placeholder="Ej: +58 412 123 4567">
        </div>
        <div class="form-group">
          <label for="register-email">Correo Electrónico</label>
          <input type="email" class="form-control" id="register-email" placeholder="tu@correo.com">
        </div>
        <div class="form-group">
          <label for="register-password">Contraseña</label>
          <input type="password" class="form-control" id="register-password" placeholder="Mínimo 6 caracteres">
        </div>
        <div class="form-group">
          <label for="register-confirm">Confirmar Contraseña</label>
          <input type="password" class="form-control" id="register-confirm" placeholder="Repite tu contraseña">
        </div>
        <button class="btn btn-blue" onclick="window.registerClub()">Registrar Club</button>
        <div style="text-align: center; margin-top: 20px;">
          <p>¿Ya tienes cuenta? <a href="#" style="color: var(--primary); text-decoration: none;" onclick="window.goToScreen('login')">Inicia sesión</a></p>
        </div>
      </div>
    </div>
    
    <!-- Pantalla 3: Bienvenida Post-Registro -->
    <div class="screen" id="welcome">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <div class="welcome-container">
        <h2>Bienvenido, <span id="club-name-welcome"></span>!</h2>
        <p class="subtitle">¡Tu club ya está listo para empezar!</p>
        <div class="handshake-container">
          <img src="assets/handshake.png" alt="Manos entrelazadas" class="handshake-img" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'150\' viewBox=\'0 0 200 150\'><rect width=\'100%\' height=\'100%\' fill=\'#f0f0f0\'/><text x=\'50%\' y=\'50%\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-family=\'Arial\' font-size=\'14\'>Imagen Cargada</text></svg>'">
        </div>
        <p>Estamos emocionados de tenerte con nosotros. ¡Comienza a registrar tus partidos y disfruta del mejor seguimiento de pádel!</p>
        <button class="btn btn-green" onclick="window.goToScreen('login')">Iniciar Sesión</button>
      </div>
    </div>
    
    <!-- Pantalla 4: Inicio -->
    <div class="screen" id="home">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2>Bienvenido, <span id="club-name-display">Cargando...</span></h2>
      <p><i class="fas fa-spinner fa-spin"></i> <span id="canchas-status">Cargando información del club...</span></p>
      
      <div id="courts-container" style="margin-top: 20px;">
        <p><i class="fas fa-spinner fa-spin"></i> Cargando canchas...</p>
      </div>
      
      <div style="margin-top: auto; text-align: center;">
        <button class="btn btn-outline" onclick="window.goToScreen('dashboard')">
          <i class="fas fa-chart-line"></i> Ver Dashboard
        </button>
        <button class="btn btn-outline" onclick="window.goToScreen('ranking')">
          <i class="fas fa-trophy"></i> Ver Ranking
        </button>
      </div>
    </div>
    
    <!-- Pantalla 5: Dashboard -->
    <div class="screen" id="dashboard">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2 style="margin-bottom: 20px; color: var(--primary);">Dashboard</h2>
      
      <div class="dashboard-stats">
        <div class="stat-card">
          <div class="stat-label">Partidos Hoy</div>
          <div class="stat-value" id="total-matches">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Jugadores Activos</div>
          <div class="stat-value" id="active-players">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Horas Jugadas</div>
          <div class="stat-value" id="total-hours">0</div>
        </div>
      </div>
      
      <div class="top-players">
        <h3 style="margin-bottom: 15px; color: var(--primary);">Mejores Jugadores</h3>
        <div id="top-players-list">
          <p>Cargando ranking...</p>
        </div>
      </div>
      
      <div>
        <h3 style="margin: 25px 0 15px; color: var(--primary);">Uso de Canchas</h3>
        <div id="courts-usage" class="canchas-usage">
          <p>Cargando uso de canchas...</p>
        </div>
      </div>
      
      <button class="btn btn-outline" style="margin-top: 20px;" onclick="window.goToScreen('home')">
        <i class="fas fa-arrow-left"></i> Volver
      </button>
    </div>
    
    <!-- Pantalla 6: Ranking -->
    <div class="screen" id="ranking">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2 style="margin-bottom: 20px; color: var(--primary);">Ranking de Jugadores</h2>
      
      <div id="ranking-list" style="margin-bottom: 20px;">
        <p>Cargando ranking...</p>
      </div>
      
      <button class="btn btn-outline" onclick="window.goToScreen('home')">
        <i class="fas fa-arrow-left"></i> Volver
      </button>
    </div>
    
    <!-- Pantalla 7: Tipo de Marcador -->
    <div class="screen" id="scoring-type">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary);">Selecciona Tipo de Marcador</h2>
      
      <button class="btn btn-blue" onclick="window.startScoring('regular')">
        <i class="fas fa-table-tennis-paddle-ball"></i> Marcador Regular (6-5)
      </button>
      <button class="btn btn-blue" onclick="window.startScoring('tiebreak')">
        <i class="fas fa-table-tennis-paddle-ball"></i> Marcador con Tiebreak (6-6)
      </button>
      
      <div style="margin-top: auto; text-align: center;">
        <button class="btn btn-outline" onclick="window.goToScreen('home')">
          <i class="fas fa-arrow-left"></i> Volver
        </button>
      </div>
    </div>
    
    <!-- Pantalla 8: Registro de Jugadores -->
    <div class="screen" id="register">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary);">Registro de Jugadores</h2>
      
      <div class="player-form" data-team="A" data-player="1">
        <h3>Equipo A - Jugador 1</h3>
        <div class="form-group">
          <label>Cédula</label>
          <div style="position: relative;">
            <input type="text" class="form-control cedula" data-team="A" data-player="1" onblur="window.validateCedula(this)">
            <div class="cedula-validation" id="cedula-status-A1"></div>
          </div>
          <div class="player-status" id="player-status-A1"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <input type="text" class="form-control first-name" data-team="A" data-player="1" placeholder="Nombres" disabled>
          </div>
          <div class="form-group">
            <input type="text" class="form-control last-name" data-team="A" data-player="1" placeholder="Apellidos" disabled>
          </div>
        </div>
      </div>
      
      <div class="player-form" data-team="A" data-player="2">
        <h3>Equipo A - Jugador 2</h3>
        <div class="form-group">
          <label>Cédula</label>
          <div style="position: relative;">
            <input type="text" class="form-control cedula" data-team="A" data-player="2" onblur="window.validateCedula(this)">
            <div class="cedula-validation" id="cedula-status-A2"></div>
          </div>
          <div class="player-status" id="player-status-A2"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <input type="text" class="form-control first-name" data-team="A" data-player="2" placeholder="Nombres" disabled>
          </div>
          <div class="form-group">
            <input type="text" class="form-control last-name" data-team="A" data-player="2" placeholder="Apellidos" disabled>
          </div>
        </div>
      </div>
      
      <div class="player-form" data-team="B" data-player="1">
        <h3>Equipo B - Jugador 1</h3>
        <div class="form-group">
          <label>Cédula</label>
          <div style="position: relative;">
            <input type="text" class="form-control cedula" data-team="B" data-player="1" onblur="window.validateCedula(this)">
            <div class="cedula-validation" id="cedula-status-B1"></div>
          </div>
          <div class="player-status" id="player-status-B1"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <input type="text" class="form-control first-name" data-team="B" data-player="1" placeholder="Nombres" disabled>
          </div>
          <div class="form-group">
            <input type="text" class="form-control last-name" data-team="B" data-player="1" placeholder="Apellidos" disabled>
          </div>
        </div>
      </div>
      
      <div class="player-form" data-team="B" data-player="2">
        <h3>Equipo B - Jugador 2</h3>
        <div class="form-group">
          <label>Cédula</label>
          <div style="position: relative;">
            <input type="text" class="form-control cedula" data-team="B" data-player="2" onblur="window.validateCedula(this)">
            <div class="cedula-validation" id="cedula-status-B2"></div>
          </div>
          <div class="player-status" id="player-status-B2"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <input type="text" class="form-control first-name" data-team="B" data-player="2" placeholder="Nombres" disabled>
          </div>
          <div class="form-group">
            <input type="text" class="form-control last-name" data-team="B" data-player="2" placeholder="Apellidos" disabled>
          </div>
        </div>
      </div>
      
      <button class="btn btn-blue" onclick="window.startGame()">Iniciar Partido</button>
      
      <div style="margin-top: auto; text-align: center;">
        <button class="btn btn-outline" onclick="window.goToScreen('scoring-type')">
          <i class="fas fa-arrow-left"></i> Volver
        </button>
      </div>
    </div>
    
    <!-- Pantalla 9: Marcador -->
    <div class="screen" id="game">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      
      <div class="scoreboard">
        <div class="team" id="teamA">
          <div class="team-name" id="teamA-name">Equipo A</div>
          <div class="score" id="scoreA">0</div>
          <div class="games" id="gamesA">0</div>
          <div class="tiebreak" id="tiebreakA" style="display: none;">TB: <span id="tiebreak-pointsA">0</span></div>
        </div>
        
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
          <div class="timer" id="timer">00:00</div>
          <div style="font-size: 12px; color: var(--text-light);">Duración del partido</div>
        </div>
        
        <div class="team" id="teamB">
          <div class="team-name" id="teamB-name">Equipo B</div>
          <div class="score" id="scoreB">0</div>
          <div class="games" id="gamesB">0</div>
          <div class="tiebreak" id="tiebreakB" style="display: none;">TB: <span id="tiebreak-pointsB">0</span></div>
        </div>
      </div>
      
      <div class="score-controls">
        <button class="btn score-btn" onclick="window.addPoint('A')">+A</button>
        <button class="btn score-btn" onclick="window.resetGame()">Reiniciar</button>
        <button class="btn score-btn" onclick="window.addPoint('B')">+B</button>
      </div>
      
      <div style="margin-top: auto; text-align: center;">
        <button class="btn btn-outline" onclick="window.confirmEndGame()">
          <i class="fas fa-flag"></i> Finalizar Partido
        </button>
      </div>
    </div>
    
    <!-- Pantalla 10: Finalización de Partido -->
    <div class="screen" id="end">
      <header onclick="window.handleLogoClick()">
        <i class="fas fa-table-tennis-paddle-ball"></i> PADELTRACK
      </header>
      <h2 style="text-align: center; margin-bottom: 25px; color: var(--primary);">Partido Finalizado</h2>
      
      <div class="scoreboard" style="margin-bottom: 30px;">
        <div class="team">
          <div class="team-name" id="end-teamA-name">Equipo A</div>
          <div class="score" id="end-scoreA">0</div>
          <div class="games" id="end-gamesA">0</div>
        </div>
        
        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
          <div class="timer" id="end-timer">00:00</div>
          <div style="font-size: 12px; color: var(--text-light);">Duración</div>
        </div>
        
        <div class="team">
          <div class="team-name" id="end-teamB-name">Equipo B</div>
          <div class="score" id="end-scoreB">0</div>
          <div class="games" id="end-gamesB">0</div>
        </div>
      </div>
      
      <div class="alert" style="margin: 20px auto; width: 90%;">
        <i class="fas fa-check-circle"></i> <strong>¡Partido registrado exitosamente!</strong>
      </div>
      
      <button class="btn btn-blue" onclick="window.goToScreen('home')">
        <i class="fas fa-home"></i> Volver al Inicio
      </button>
      
      <button class="btn btn-outline" onclick="window.goToScreen('ranking')" style="margin-top: 10px;">
        <i class="fas fa-trophy"></i> Ver Ranking
      </button>
    </div>
  </div>

  <script>
    // Inicialización de Supabase (REEMPLAZA CON TUS CREDENCIALES)
	const supabaseUrl = 'https://omizjfxbxkfkxlxdkbej.supabase.co'; // ¡REEMPLAZA ESTO!
	const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9taXpqZnhieGtma3hseGRrYmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NzkyMjIsImV4cCI6MjA3MTA1NTIyMn0.UAj61BfHqIF8Gg9bHYsEF_ocTM8Og4oJN2bWT11N6Rg'; // ¡REEMPLAZA ESTO!
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    
    // Manejo seguro del clic en el logo
    window.handleLogoClick = function() {
      // Si hay usuario autenticado, ir a home
      if (window.currentUser) {
        window.goToScreen('home');
      } 
      // Si está en la pantalla de bienvenida, ir a login
      else if (document.getElementById('welcome')?.classList.contains('active')) {
        window.goToScreen('login');
      }
      // En cualquier otro caso, ir a login
      else {
        window.goToScreen('login');
      }
    };
    
    // Navegación entre pantallas - Versión segura
    window.goToScreen = function(id) {
      // Si intenta acceder a pantallas protegidas sin estar autenticado
      const protectedScreens = ['home', 'scoring-type', 'register', 'game', 'end', 'ranking', 'dashboard'];
      if (protectedScreens.includes(id) && !window.currentUser) {
        window.showNotification('Por favor, inicia sesión primero');
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('login').classList.add('active');
        return;
      }
      
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      
      // Si es la pantalla de inicio, actualizar con los datos del club
      if (id === 'home' && window.currentUser && window.currentClub) {
        window.updateHomeScreen();
      }
      
      // Reiniciar marcador al salir
      if (id !== 'game' && window.interval) {
        clearInterval(window.interval);
        window.interval = null;
      }
      
      // Si es el dashboard, cargar datos
      if (id === 'dashboard' && window.currentUser && window.currentClub) {
        window.loadDashboard();
      }
      
      // Actualizar nombres de equipos en el marcador
      if (id === 'game') {
        window.updateTeamNamesDisplay();
      }
      
      // Si es registro, resetear validaciones
      if (id === 'register') {
        window.resetPlayerValidation();
      }
      
      // Si es ranking, cargar ranking
      if (id === 'ranking') {
        // Mostrar estado de carga inicial
        const rankingList = document.getElementById('ranking-list');
        if (rankingList) {
          rankingList.innerHTML = '<p>Cargando ranking...</p>';
        }
        // Cargar ranking después de un breve retraso
        setTimeout(window.loadRanking, 100);
      }
      
      // Si es la pantalla de bienvenida, actualizar con el nombre del club
      if (id === 'welcome' && window.currentClub) {
        const clubNameWelcome = document.getElementById('club-name-welcome');
        if (clubNameWelcome && window.currentClub) {
          clubNameWelcome.textContent = window.currentClub.name;
          console.log("Nombre del club actualizado en pantalla de bienvenida");
        }
      }
      
      // Asegurar que el scroll esté en la parte superior
      const screen = document.getElementById(id);
      if (screen) {
        screen.scrollTop = 0;
      }
    };
    
    // Mostrar notificación
    window.showNotification = function(message) {
      const notification = document.getElementById('notification');
      if (!notification) return;
      
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    };
    
    // Actualizar la pantalla de inicio con los datos del club
    window.updateHomeScreen = async function() {
      if (!window.currentUser) return;
      
      // Mostrar estado de carga inicial
      const clubNameDisplay = document.getElementById('club-name-display');
      const canchasStatus = document.getElementById('canchas-status');
      const courtsContainer = document.getElementById('courts-container');
      
      if (clubNameDisplay) clubNameDisplay.textContent = 'Cargando...';
      if (canchasStatus) canchasStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando información del club...';
      if (courtsContainer) courtsContainer.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Cargando canchas...</p>';
      
      try {
        // Obtener los datos del club desde Supabase
        const { data, error } = await window.supabase
          .from('clubs')
          .select('*')
          .eq('id', window.currentUser.id)
          .single();
        
        if (error) {
          console.error("Error al obtener datos del club:", error);
          // CREAR EL CLUB AUTOMÁTICAMENTE SI NO EXISTE
          const { error: createError } = await window.supabase
            .from('clubs')
            .insert([
              {
                id: window.currentUser.id,
                name: "Nuevo Club",
                court_count: 0,
                email: window.currentUser.email,
                phone: "N/A",
                status: "active"
              }
            ]);
          
          if (createError) {
            console.error("Error al crear club automáticamente:", createError);
            if (clubNameDisplay) clubNameDisplay.textContent = "Club";
            if (canchasStatus) canchasStatus.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error: ${createError.code}`;
            if (courtsContainer) courtsContainer.innerHTML = `
              <div class="alert" style="margin: 20px auto; width: 90%;">
                <i class="fas fa-exclamation-circle"></i> <strong>Error:</strong> ${createError.message}
              </div>
            `;
            return;
          }
          
          // Volver a intentar cargar los datos
          window.updateHomeScreen();
          return;
        }
        
        if (data) {
          const clubData = data;
          const clubName = clubData.name || "Club";
          const courtCount = window.safeNumber(clubData.court_count, 0);
          
          // Actualizar nombre del club
          if (clubNameDisplay) clubNameDisplay.textContent = clubName;
          
          // Almacenar los datos del club
          window.currentClub = clubData;
          
          // Actualizar estado de canchas
          if (courtCount <= 0) {
            if (canchasStatus) canchasStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> No existen canchas cargadas';
            // Mensaje específico para 0 canchas
            if (courtsContainer) courtsContainer.innerHTML = `
              <div class="alert" style="margin: 20px auto; width: 90%;">
                <i class="fas fa-exclamation-circle"></i> <strong>Importante:</strong> No existen canchas cargadas para este club.
              </div>
              <button class="btn btn-blue" onclick="window.goToScreen('club-settings')">
                <i class="fas fa-cog"></i> Configurar canchas
              </button>
            `;
          } else {
            // Mostrar cantidad correcta de canchas
            if (canchasStatus) canchasStatus.textContent = `${courtCount} canchas disponibles`;
            // Generar botones de canchas
            if (courtsContainer) {
              courtsContainer.innerHTML = '';
              for (let i = 1; i <= courtCount; i++) {
                const courtBtn = document.createElement('button');
                courtBtn.className = 'btn';
                courtBtn.innerHTML = `<i class="fas fa-table-tennis-paddle-ball"></i> Cancha ${i}`;
                courtBtn.onclick = function() {
                  window.selectedCourt = `Cancha ${i}`;
                  window.goToScreen('scoring-type');
                };
                courtsContainer.appendChild(courtBtn);
              }
            }
          }
        } else {
          // El club no existe (caso improbable con Supabase)
          if (clubNameDisplay) clubNameDisplay.textContent = "Club";
          if (canchasStatus) canchasStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error al cargar datos';
          if (courtsContainer) courtsContainer.innerHTML = `
            <div class="alert" style="margin: 20px auto; width: 90%;">
              <i class="fas fa-exclamation-circle"></i> <strong>Error:</strong> No se encontró información del club.
            </div>
          `;
        }
      } catch (error) {
        console.error("Error crítico al actualizar pantalla de inicio:", error);
        if (clubNameDisplay) clubNameDisplay.textContent = "Club";
        if (canchasStatus) canchasStatus.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error crítico';
        if (courtsContainer) courtsContainer.innerHTML = `
          <div class="alert" style="margin: 20px auto; width: 90%;">
            <i class="fas fa-exclamation-circle"></i> <strong>Error crítico:</strong> ${error.message}
          </div>
        `;
      }
    };
    
    // Función para registrar un nuevo club
    window.registerClub = async function() {
      const clubName = document.getElementById('club-name')?.value?.trim() || '';
      let clubRif = document.getElementById('club-rif')?.value?.trim() || '';
      const courtCount = document.getElementById('court-count')?.value?.trim() || '';
      const email = document.getElementById('register-email')?.value?.trim() || '';
      const phoneElement = document.getElementById('phone-number');
      const phone = phoneElement ? phoneElement.value?.trim() : '';
      const password = document.getElementById('register-password')?.value || '';
      const confirmPassword = document.getElementById('register-confirm')?.value || '';
      
      // 1. Validar campos requeridos
      if (!clubName || !clubRif || !courtCount || !email || !password || !confirmPassword) {
        window.showNotification('Por favor, completa todos los campos requeridos');
        return;
      }
      
      // 2. Validación específica y robusta para teléfono
      if (!phone || phone.replace(/\D/g, '').length < 7) {
        window.showNotification('Por favor, ingresa un número de teléfono válido (mínimo 7 dígitos)');
        return;
      }
      
      // 3. Asegurar que el RIF esté en mayúsculas
      clubRif = clubRif.toUpperCase();
      if (document.getElementById('club-rif')) {
        document.getElementById('club-rif').value = clubRif;
      }
      
      // 4. Validar formato del RIF
      const rifRegex = /^[Jj]-\d{8}-\d$/;
      if (!rifRegex.test(clubRif)) {
        window.showNotification('Formato de RIF inválido. Debe ser como J-12345678-9');
        return;
      }
      
      // 5. Validar cantidad de canchas
      const courts = parseInt(courtCount);
      if (isNaN(courts) || courts < 1 || courts > 20) {
        window.showNotification('La cantidad de canchas debe ser entre 1 y 20');
        return;
      }
      
      // 6. Validar contraseñas
      if (password !== confirmPassword) {
        window.showNotification('Las contraseñas no coinciden');
        return;
      }
      
      // 7. Validar longitud de contraseña
      if (password.length < 6) {
        window.showNotification('La contraseña debe tener al menos 6 caracteres');
        return;
      }
      
      try {
        // 8. Registrar usuario en Supabase Auth
        const { data, error } = await window.supabase.auth.signUp({
          email: email,
          password: password
        });
        
        if (error) {
          if (error.message.includes('email already exists')) {
            window.showNotification('Este correo electrónico ya está registrado');
          } else {
            window.showNotification(`Error: ${error.message}`);
          }
          return;
        }
        
        // 9. Manejar caso especial: verificación de email
        if (!data.user) {
          window.showNotification('Verifica tu correo electrónico para completar el registro');
          return;
        }
        
        // 10. CREAR CLUB EN LA TABLA CLUBS
        const { error: clubError } = await window.supabase
          .from('clubs')
          .insert([
            {
              id: data.user.id,
              rif: clubRif,
              name: clubName,
              court_count: courts,
              email: email,
              phone: phone.replace(/\D/g, '').substring(0, 15),
              status: "active"
            }
          ]);
        
        if (clubError) {
          console.error("Error DETALLADO al crear club:", {
            code: clubError.code,
            message: clubError.message,
            details: clubError.details,
            hint: clubError.hint
          });
          
          if (clubError.code === '23505') {
            window.showNotification('Este RIF ya está registrado');
          } else if (clubError.code === '42501') {
            window.showNotification('Error de permisos. Configura RLS en la tabla clubs');
          } else {
            window.showNotification(`Error al registrar club: ${clubError.message}`);
          }
          return;
        }
        
        // 11. Establecer el usuario actual
        window.currentUser = data.user;
        
        // 12. MOSTRAR PANTALLA DE BIENVENIDA
        window.showNotification('¡Club registrado exitosamente!');
        
        // Mostrar la pantalla de bienvenida
        window.goToScreen('welcome');
        
        // Actualizar el nombre del club directamente
        setTimeout(() => {
          const clubNameWelcome = document.getElementById('club-name-welcome');
          if (clubNameWelcome) {
            clubNameWelcome.textContent = clubName;
            console.log("Nombre del club actualizado directamente en pantalla de bienvenida");
          }
        }, 100);
        
      } catch (error) {
        console.error("Error inesperado al registrar club:", error);
        window.showNotification(`Error inesperado: ${error.message}`);
      }
    };
    
    // Iniciar sesión
    window.loginUser = async function() {
      const email = document.getElementById('login-email')?.value;
      const password = document.getElementById('login-password')?.value;
      
      if (!email || !password) {
        window.showNotification('Por favor, completa todos los campos');
        return;
      }
      
      try {
        const { data, error } = await window.supabase.auth.signInWithPassword({
          email: email,
          password: password
        });
        
        if (error) {
          window.showNotification(`Error: ${error.message}`);
          return;
        }
        
        window.currentUser = data.user;
        window.goToScreen('home');
      } catch (error) {
        window.showNotification(`Error inesperado: ${error.message}`);
      }
    };
    
    // Función utilitaria para convertir valores a números seguros
    window.safeNumber = function(value, defaultValue = 0) {
      if (value === undefined || value === null) return defaultValue;
      const num = typeof value === 'string' ? parseInt(value) : value;
      return isNaN(num) || num < 0 ? defaultValue : num;
    };
    
    // Variables globales
    window.currentUser = null;
    window.currentClub = null;
    window.selectedCourt = "Cancha 1";
    window.scoringType = null;
    window.scoreA = 0;
    window.scoreB = 0;
    window.gamesA = 0;
    window.gamesB = 0;
    window.inTiebreak = false;
    window.tiebreakPointsA = 0;
    window.tiebreakPointsB = 0;
    window.seconds = 0;
    window.interval = null;
    window.gameDuration = "00:00";
    window.teamNames = {
      teamA: "Equipo A",
      teamB: "Equipo B"
    };
    window.playersData = {
      'A1': { cedula: '', firstName: '', lastName: '', exists: false },
      'A2': { cedula: '', firstName: '', lastName: '', exists: false },
      'B1': { cedula: '', firstName: '', lastName: '', exists: false },
      'B2': { cedula: '', firstName: '', lastName: '', exists: false }
    };
    
    // Inicialización de la aplicación
    document.addEventListener('DOMContentLoaded', function() {
      // Ajustar altura del contenedor para móviles
      function adjustContainerHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        const container = document.querySelector('.container');
        if (container) {
          container.style.height = `calc(var(--vh, 1vh) * 100)`;
        }
      }
      
      // Ajustar en carga y resize
      adjustContainerHeight();
      window.addEventListener('resize', adjustContainerHeight);
      
      // Configurar listener de autenticación
      supabase.auth.onAuthStateChange((event, session) => {
        window.currentUser = session?.user || null;
        
        if (window.currentUser) {
          // Intentar cargar datos del club
          window.updateHomeScreen();
        }
      });
      
      // Obtener estado de sesión actual
      supabase.auth.getSession().then(({ data: { session } }) => {
        window.currentUser = session?.user || null;
        
        if (window.currentUser) {
          // Si hay usuario, ir a home
          window.goToScreen('home');
        } else {
          // Si no hay usuario, ir a login
          window.goToScreen('login');
        }
      });
    });
    
    // Función para validar cédula
    window.validateCedula = async function(input) {
      let cedula = input.value.trim();
      const team = input.dataset.team;
      const player = input.dataset.player;
      const id = team + player;
      
      // Limpiar validación previa
      const statusElement = document.getElementById(`cedula-status-${id}`);
      const playerStatusElement = document.getElementById(`player-status-${id}`);
      const errorElement = document.getElementById(`error-${id}`);
      
      if (statusElement) statusElement.innerHTML = '';
      if (playerStatusElement) playerStatusElement.textContent = '';
      if (errorElement) errorElement.style.display = 'none';
      
      // Si está vacío, no validar
      if (!cedula) return;
      
      // Asegurar que la cédula esté en mayúsculas
      cedula = cedula.toUpperCase();
      input.value = cedula;
      
      // Validar formato
      if (!window.validateCedulaFormat(cedula)) {
        if (statusElement) {
          statusElement.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
          statusElement.className = 'cedula-validation invalid';
        }
        if (playerStatusElement) {
          playerStatusElement.textContent = 'Formato inválido (ej: V-12345678)';
        }
        return;
      }
      
      // Mostrar estado de carga
      if (statusElement) {
        statusElement.innerHTML = '<i class="fas fa-spinner"></i>';
        statusElement.className = 'cedula-validation loading';
      }
      
      // Buscar en Supabase
      const { data, error } = await window.supabase
        .from('players')
        .select('*')
        .eq('cedula', cedula)
        .eq('club_id', window.currentUser.id)
        .single();
      
      if (error) {
        if (error.code === 'PGRST116') {
          // Nuevo jugador PARA ESTE CLUB
          if (statusElement) {
            statusElement.innerHTML = '<i class="fas fa-user-plus"></i>';
            statusElement.className = 'cedula-validation valid';
          }
          if (playerStatusElement) {
            playerStatusElement.textContent = 'Nuevo jugador en este club';
          }
          
          // Habilitar campos de nombre y apellido
          const firstNameInput = document.querySelector(`.first-name[data-team="${team}"][data-player="${player}"]`);
          const lastNameInput = document.querySelector(`.last-name[data-team="${team}"][data-player="${player}"]`);
          
          if (firstNameInput) firstNameInput.disabled = false;
          if (lastNameInput) lastNameInput.disabled = false;
          
          // Guardar datos (solo cédula por ahora)
          window.playersData[id] = {
            cedula: cedula,
            firstName: '',
            lastName: '',
            exists: false
          };
        } else {
          console.error("Error al validar cédula:", error);
          if (statusElement) {
            statusElement.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
            statusElement.className = 'cedula-validation invalid';
          }
          if (playerStatusElement) {
            playerStatusElement.textContent = 'Error al verificar';
          }
        }
      } else {
        // Jugador existe EN ESTE CLUB
        if (statusElement) {
          statusElement.innerHTML = '<i class="fas fa-check-circle"></i>';
          statusElement.className = 'cedula-validation valid';
        }
        if (playerStatusElement) {
          playerStatusElement.textContent = 'Jugador existente en este club';
        }
        
        // Rellenar nombre y apellido
        const firstNameInput = document.querySelector(`.first-name[data-team="${team}"][data-player="${player}"]`);
        const lastNameInput = document.querySelector(`.last-name[data-team="${team}"][data-player="${player}"]`);
        
        if (firstNameInput) firstNameInput.value = data.first_name || '';
        if (lastNameInput) lastNameInput.value = data.last_name || '';
        if (firstNameInput) firstNameInput.disabled = true;
        if (lastNameInput) lastNameInput.disabled = true;
        
        // Guardar datos
        window.playersData[id] = {
          cedula: cedula,
          firstName: data.first_name || '',
          lastName: data.last_name || '',
          exists: true
        };
      }
    };
    
    // Validar formato de cédula venezolana
    window.validateCedulaFormat = function(cedula) {
      const cedulaRegex = /^[VvEePp]-\d{7,8}$/;
      return cedulaRegex.test(cedula);
    };
    
    // Función para registrar jugadores
    window.startGame = async function() {
      // Validar que todos los jugadores tengan datos completos
      const missingData = [];
      Object.keys(window.playersData).forEach(key => {
        const data = window.playersData[key];
        if (!data.cedula) {
          missingData.push(`Jugador ${key}`);
        } else if (!data.exists) {
          // Para jugadores nuevos, obtener los nombres del DOM
          const firstNameInput = document.querySelector(`.first-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
          const lastNameInput = document.querySelector(`.last-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
          
          const firstName = firstNameInput?.value?.trim() || '';
          const lastName = lastNameInput?.value?.trim() || '';
          
          if (!firstName || !lastName) {
            missingData.push(`Jugador ${key}`);
          }
        }
      });
      
      if (missingData.length > 0) {
        window.showNotification(`Faltan datos de: ${missingData.join(', ')}`);
        return;
      }
      
      if (!window.currentUser) {
        window.showNotification('Error: No has iniciado sesión. Por favor, inicia sesión primero.');
        window.goToScreen('login');
        return;
      }
      
      // Registrar jugadores en la base de datos (SOLO PARA ESTE CLUB)
      for (const key in window.playersData) {
        const player = window.playersData[key];
        if (player.exists) continue; // Ya existe en este club
        
        // Obtener los valores del DOM
        const firstNameInput = document.querySelector(`.first-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
        const lastNameInput = document.querySelector(`.last-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
        
        const firstName = firstNameInput?.value?.trim() || '';
        const lastName = lastNameInput?.value?.trim() || '';
        
        // Validar que los nombres no estén vacíos
        if (!firstName || !lastName) {
          window.showNotification(`Por favor, completa los nombres para el jugador ${key}`);
          return;
        }
        
        // Intentar insertar el jugador
        const { error: insertError } = await window.supabase
          .from('players')
          .insert([
            {
              club_id: window.currentUser.id,
              cedula: player.cedula,
              first_name: firstName,
              last_name: lastName,
              matches_played: 0,
              matches_won: 0,
              created_at: new Date().toISOString(),
              last_match_date: new Date().toISOString()
            }
          ]);
        
        if (insertError) {
          if (insertError.code === '23505') {
            console.error("Error de unicidad inesperado:", insertError);
          } else {
            console.error("Error al registrar jugador:", insertError);
            window.showNotification(`Error al registrar ${firstName} ${lastName}`);
            return;
          }
        }
        
        // Actualizar playersData con los nombres reales
        window.playersData[key] = {
          ...window.playersData[key],
          firstName: firstName,
          lastName: lastName
        };
      }
      
      // Reiniciar marcador
      window.scoreA = 0;
      window.scoreB = 0;
      window.gamesA = 0;
      window.gamesB = 0;
      window.inTiebreak = false;
      window.tiebreakPointsA = 0;
      window.tiebreakPointsB = 0;
      window.seconds = 0;
      
      // Actualizar nombres de equipos
      window.teamNames = {
        teamA: `${window.playersData['A1'].firstName} ${window.playersData['A1'].lastName} / ${window.playersData['A2'].firstName} ${window.playersData['A2'].lastName}`,
        teamB: `${window.playersData['B1'].firstName} ${window.playersData['B1'].lastName} / ${window.playersData['B2'].firstName} ${window.playersData['B2'].lastName}`
      };
      
      // Iniciar temporizador
      window.startTimer();
      
      // Ir a la pantalla de marcador
      window.goToScreen('game');
    };
    
    // Iniciar temporizador
    window.startTimer = function() {
      if (window.interval) {
        clearInterval(window.interval);
      }
      
      window.interval = setInterval(() => {
        window.seconds++;
        const minutes = Math.floor(window.seconds / 60);
        const remainingSeconds = window.seconds % 60;
        window.gameDuration = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        document.getElementById('timer').textContent = window.gameDuration;
      }, 1000);
    };
    
    // Actualizar nombres de equipos en el marcador
    window.updateTeamNamesDisplay = function() {
      document.getElementById('teamA-name').textContent = window.teamNames.teamA;
      document.getElementById('teamB-name').textContent = window.teamNames.teamB;
    };
    
    // Añadir punto
    window.addPoint = function(team) {
      if (window.inTiebreak) {
        if (team === 'A') {
          window.tiebreakPointsA++;
        } else {
          window.tiebreakPointsB++;
        }
        
        // Actualizar interfaz
        document.getElementById('tiebreak-pointsA').textContent = window.tiebreakPointsA;
        document.getElementById('tiebreak-pointsB').textContent = window.tiebreakPointsB;
        
        // Verificar finalización del tiebreak
        if ((window.tiebreakPointsA >= 7 || window.tiebreakPointsB >= 7) && 
            Math.abs(window.tiebreakPointsA - window.tiebreakPointsB) >= 2) {
          window.inTiebreak = false;
          if (window.tiebreakPointsA > window.tiebreakPointsB) {
            window.gamesA++;
          } else {
            window.gamesB++;
          }
          
          // Actualizar interfaz
          document.getElementById('gamesA').textContent = window.gamesA;
          document.getElementById('gamesB').textContent = window.gamesB;
          document.getElementById('tiebreakA').style.display = 'none';
          document.getElementById('tiebreakB').style.display = 'none';
        }
      } else {
        if (team === 'A') {
          window.scoreA++;
        } else {
          window.scoreB++;
        }
        
        // Actualizar interfaz
        document.getElementById('scoreA').textContent = window.scoreA;
        document.getElementById('scoreB').textContent = window.scoreB;
        
        // Verificar si hay ganador del juego
        if ((window.scoreA >= 5 || window.scoreB >= 5) && 
            Math.abs(window.scoreA - window.scoreB) >= 2) {
          if (window.scoringType === 'tiebreak' && window.scoreA === 6 && window.scoreB === 6) {
            // Iniciar tiebreak
            window.inTiebreak = true;
            window.tiebreakPointsA = 0;
            window.tiebreakPointsB = 0;
            
            // Actualizar interfaz
            document.getElementById('tiebreak-pointsA').textContent = '0';
            document.getElementById('tiebreak-pointsB').textContent = '0';
            document.getElementById('tiebreakA').style.display = 'block';
            document.getElementById('tiebreakB').style.display = 'block';
          } else {
            // Registrar juego ganado
            if (window.scoreA > window.scoreB) {
              window.gamesA++;
            } else {
              window.gamesB++;
            }
            
            // Reiniciar puntos
            window.scoreA = 0;
            window.scoreB = 0;
            
            // Actualizar interfaz
            document.getElementById('scoreA').textContent = '0';
            document.getElementById('scoreB').textContent = '0';
            document.getElementById('gamesA').textContent = window.gamesA;
            document.getElementById('gamesB').textContent = window.gamesB;
          }
        }
      }
    };
    
    // Reiniciar juego
    window.resetGame = function() {
      window.scoreA = 0;
      window.scoreB = 0;
      window.inTiebreak = false;
      window.tiebreakPointsA = 0;
      window.tiebreakPointsB = 0;
      
      // Actualizar interfaz
      document.getElementById('scoreA').textContent = '0';
      document.getElementById('scoreB').textContent = '0';
      document.getElementById('tiebreak-pointsA').textContent = '0';
      document.getElementById('tiebreak-pointsB').textContent = '0';
      document.getElementById('tiebreakA').style.display = 'none';
      document.getElementById('tiebreakB').style.display = 'none';
    };
    
    // Confirmar finalización de partido
    window.confirmEndGame = function() {
      if (window.gamesA === window.gamesB) {
        window.showNotification('El partido debe tener un ganador');
        return;
      }
      
      // Mostrar confirmación
      if (confirm('¿Estás seguro de finalizar este partido?')) {
        window.endGame();
      }
    };
    
    // Finalizar partido
    window.endGame = function() {
      const winner = window.gamesA > window.gamesB ? 'A' : 'B';
      const teamAName = window.teamNames.teamA;
      const teamBName = window.teamNames.teamB;
      
      // Guardar partido en Supabase
      window.supabase
        .from('matches')
        .insert([
          {
            club_id: window.currentUser.id,
            court: window.selectedCourt,
            scoring_type: window.scoringType,
            team_a_name: teamAName,
            team_b_name: teamBName,
            winner: winner === 'A' ? 'teamA' : 'teamB',
            score: `${window.scoreA}-${window.scoreB}`,
            games: `${window.gamesA}-${window.gamesB}`,
            duration: window.gameDuration,
            created_at: new Date().toISOString()
          }
        ])
        .then(async ({ error }) => {
          if (error) {
            console.error("Error al guardar partido: ", error);
            window.showNotification('Error al guardar partido. Inténtalo de nuevo.');
            window.goToScreen('end');
            return;
          }
          
          // Actualizar estadísticas de jugadores
          await window.updatePlayerStats(winner === 'A' ? 'teamA' : 'teamB');
          
          // Actualizar uso de cancha
          try {
            const { error: courtError } = await window.supabase
              .rpc('increment_court_usage', {
                p_club_id: window.currentUser.id,
                p_court: window.selectedCourt
              });
            
            if (courtError) {
              console.error("Error al actualizar uso de canchas:", courtError);
            }
          } catch (error) {
            console.error("Error CRÍTICO al actualizar uso de canchas:", error);
          }
          
          // Mostrar pantalla de finalización
          window.goToScreen('end');
          
          // Actualizar pantalla de finalización
          document.getElementById('end-teamA-name').textContent = teamAName;
          document.getElementById('end-teamB-name').textContent = teamBName;
          document.getElementById('end-scoreA').textContent = window.scoreA;
          document.getElementById('end-scoreB').textContent = window.scoreB;
          document.getElementById('end-gamesA').textContent = window.gamesA;
          document.getElementById('end-gamesB').textContent = window.gamesB;
          document.getElementById('end-timer').textContent = window.gameDuration;
        });
    };
    
    // Función para actualizar estadísticas
    window.updatePlayerStats = async function(winnerTeam) {
      if (!window.currentUser) return;
      
      // Actualizar cada jugador
      for (const key in window.playersData) {
        const player = window.playersData[key];
        if (!player.cedula) continue;
        
        try {
          // Verificar si el jugador existe
          const { data: existingPlayer, error } = await window.supabase
            .from('players')
            .select('matches_played, matches_won')
            .eq('cedula', player.cedula)
            .eq('club_id', window.currentUser.id)
            .single();
          
          if (error && error.code !== 'PGRST116') {
            console.error(`Error al obtener jugador ${player.cedula}:`, error);
            continue;
          }
          
          // Calcular nuevos valores
          let newMatchesPlayed = 1;
          let newMatchesWon = 0;
          
          if (existingPlayer) {
            newMatchesPlayed = existingPlayer.matches_played + 1;
            if ((winnerTeam === 'teamA' && key[0] === 'A') || 
                (winnerTeam === 'teamB' && key[0] === 'B')) {
              newMatchesWon = existingPlayer.matches_won + 1;
            } else {
              newMatchesWon = existingPlayer.matches_won;
            }
          } else {
            if ((winnerTeam === 'teamA' && key[0] === 'A') || 
                (winnerTeam === 'teamB' && key[0] === 'B')) {
              newMatchesWon = 1;
            }
          }
          
          // Actualizar o crear jugador
          const { error: updateError } = await window.supabase
            .from('players')
            .upsert([
              {
                cedula: player.cedula,
                club_id: window.currentUser.id,
                first_name: player.firstName,
                last_name: player.lastName,
                matches_played: newMatchesPlayed,
                matches_won: newMatchesWon,
                last_match_date: new Date().toISOString()
              }
            ], {
              onConflict: 'cedula,club_id'
            });
          
          if (updateError) {
            console.error(`Error al actualizar jugador ${player.cedula}:`, updateError);
          }
        } catch (error) {
          console.error(`Error CRÍTICO al actualizar jugador ${player.cedula}:`, error);
        }
      }
      
      console.log("Estadísticas actualizadas correctamente");
      window.loadRanking();
    };
    
    // Función para cargar ranking
    window.loadRanking = async function() {
      if (!window.currentUser) {
        const rankingList = document.getElementById('ranking-list');
        if (rankingList) {
          rankingList.innerHTML = `
            <div class="alert">
              <i class="fas fa-exclamation-circle"></i> 
              <strong>Error:</strong> Por favor, inicia sesión primero
            </div>
          `;
        }
        return;
      }
      
      // Mostrar mensaje de carga
      const rankingList = document.getElementById('ranking-list');
      if (rankingList) {
        rankingList.innerHTML = `
          <p style="display: flex; align-items: center; justify-content: center; height: 60px;">
            <i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i> Cargando ranking...
          </p>
        `;
      }
      
      try {
        // Consulta a Supabase
        const { data, error } = await window.supabase
          .from('players')
          .select('*')
          .eq('club_id', window.currentUser.id)
          .order('matches_won', { ascending: false })
          .limit(10);
        
        if (error) {
          console.error("Error al cargar ranking:", error);
          if (rankingList) {
            rankingList.innerHTML = `
              <div class="alert" style="margin: 15px 0;">
                <i class="fas fa-exclamation-circle"></i> 
                <strong>Error al cargar ranking: ${error.message}</strong>
              </div>
            `;
          }
          return;
        }
        
        if (!data || data.length === 0) {
          if (rankingList) {
            rankingList.innerHTML = `
              <p style="text-align: center; padding: 15px; color: #666;">
                <i class="fas fa-user-friends" style="font-size: 24px; display: block; margin-bottom: 10px;"></i>
                No hay jugadores registrados en tu club
              </p>
            `;
          }
          return;
        }
        
        // Generar HTML del ranking
        let html = '';
        let rank = 1;
        data.forEach(player => {
          const matchesPlayed = player.matches_played || 0;
          const matchesWon = player.matches_won || 0;
          const winPercentage = matchesPlayed > 0 ? 
            Math.round((matchesWon / matchesPlayed) * 100) : 0;
          
          html += `
            <div class="ranking-item">
              <span class="ranking-rank">${rank}.</span>
              <span style="flex: 1;">
                <strong>${player.first_name || 'Nombre'} ${player.last_name || 'Apellido'}</strong>
                <div class="win-percentage">${winPercentage}% de victorias</div>
              </span>
              <span>
                <span class="ranking-wins">${matchesWon}</span>-
                <span class="ranking-losses">${matchesPlayed - matchesWon}</span>
              </span>
            </div>
          `;
          rank++;
        });
        
        if (rankingList) {
          rankingList.innerHTML = html;
        }
      } catch (error) {
        console.error("Error crítico al cargar ranking:", error);
        if (rankingList) {
          rankingList.innerHTML = `
            <div class="alert" style="margin: 15px 0;">
              <i class="fas fa-exclamation-circle"></i> 
              <strong>Error crítico:</strong> ${error.message}
            </div>
          `;
        }
      }
    };
    
    // Función para iniciar el marcador
    window.startScoring = function(type) {
      window.scoringType = type;
      window.goToScreen('register');
    };
    
    // Función para resetear validación de jugadores
    window.resetPlayerValidation = function() {
      Object.keys(window.playersData).forEach(key => {
        window.playersData[key] = {
          cedula: '',
          firstName: '',
          lastName: '',
          exists: false
        };
        
        // Limpiar campos
        const cedulaInput = document.querySelector(`.cedula[data-team="${key[0]}"][data-player="${key[1]}"]`);
        const firstNameInput = document.querySelector(`.first-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
        const lastNameInput = document.querySelector(`.last-name[data-team="${key[0]}"][data-player="${key[1]}"]`);
        
        if (cedulaInput) cedulaInput.value = '';
        if (firstNameInput) {
          firstNameInput.value = '';
          firstNameInput.disabled = true;
        }
        if (lastNameInput) {
          lastNameInput.value = '';
          lastNameInput.disabled = true;
        }
        
        // Limpiar estado
        const statusElement = document.getElementById(`cedula-status-${key}`);
        const playerStatusElement = document.getElementById(`player-status-${key}`);
        
        if (statusElement) statusElement.innerHTML = '';
        if (playerStatusElement) playerStatusElement.textContent = '';
      });
    };
    
    // Función para cargar dashboard
    window.loadDashboard = async function() {
      if (!window.currentUser) {
        // Mostrar mensaje de error
        const totalMatches = document.getElementById('total-matches');
        const activePlayers = document.getElementById('active-players');
        const totalHours = document.getElementById('total-hours');
        const topPlayersList = document.getElementById('top-players-list');
        const courtsUsage = document.getElementById('courts-usage');
        
        if (totalMatches) totalMatches.textContent = "0";
        if (activePlayers) activePlayers.textContent = "0";
        if (totalHours) totalHours.textContent = "0";
        if (topPlayersList) topPlayersList.innerHTML = '<p>Por favor, inicia sesión primero</p>';
        if (courtsUsage) courtsUsage.innerHTML = '<p>Inicia sesión para ver el uso de canchas</p>';
        return;
      }
      
      const clubId = window.currentUser.id;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const lastWeek = new Date();
      lastWeek.setDate(today.getDate() - 7);
      
      try {
        // 1. Partidos del día
        const { data: matchesData, error: matchesError } = await window.supabase
          .from('matches')
          .select('id')
          .eq('club_id', clubId)
          .gte('created_at', today.toISOString());
        
        if (matchesError) {
          console.error("Error al obtener partidos del día:", matchesError);
        }
        
        // 2. Jugadores activos
        const { data: playersData, error: playersError } = await window.supabase
          .from('players')
          .select('id')
          .eq('club_id', clubId)
          .gt('matches_played', 0);
        
        if (playersError) {
          console.error("Error al obtener jugadores activos:", playersError);
        }
        
        // 3. Horas jugadas (aproximación)
        const totalMatches = matchesData ? matchesData.length : 0;
        const totalHours = Math.floor(totalMatches * 45 / 60);
        
        // 4. Mejores jugadores
        const { data: topPlayersData, error: topPlayersError } = await window.supabase
          .from('players')
          .select('*')
          .eq('club_id', clubId)
          .order('matches_won', { ascending: false })
          .limit(5);
        
        if (topPlayersError) {
          console.error("Error al obtener mejores jugadores:", topPlayersError);
        }
        
        // 5. Uso de canchas
        const { data: courtsData, error: courtsError } = await window.supabase
          .from('court_usage')
          .select('*')
          .eq('club_id', clubId)
          .gte('date', lastWeek.toISOString());
        
        if (courtsError) {
          console.error("Error al obtener uso de canchas:", courtsError);
        }
        
        // Actualizar interfaz
        const totalMatchesElement = document.getElementById('total-matches');
        const activePlayersElement = document.getElementById('active-players');
        const totalHoursElement = document.getElementById('total-hours');
        const topPlayersListElement = document.getElementById('top-players-list');
        const courtsUsageElement = document.getElementById('courts-usage');
        
        if (totalMatchesElement) totalMatchesElement.textContent = totalMatches;
        if (activePlayersElement) activePlayersElement.textContent = playersData ? playersData.length : '0';
        if (totalHoursElement) totalHoursElement.textContent = totalHours;
        
        // Actualizar mejores jugadores
        if (topPlayersListElement) {
          if (topPlayersData && topPlayersData.length > 0) {
            let html = '';
            let rank = 1;
            topPlayersData.forEach(player => {
              const winPercentage = player.matches_played > 0 ? 
                Math.round((player.matches_won / player.matches_played) * 100) : 0;
              
              html += `
                <div class="player-item">
                  <span class="player-rank">${rank}.</span>
                  <span>${player.first_name} ${player.last_name}</span>
                  <span>${winPercentage}%</span>
                </div>
              `;
              rank++;
            });
            topPlayersListElement.innerHTML = html;
          } else {
            topPlayersListElement.innerHTML = '<p>No hay jugadores con partidos registrados</p>';
          }
        }
        
        // Actualizar uso de canchas
        if (courtsUsageElement) {
          if (courtsData && courtsData.length > 0) {
            let html = '<canvas id="courtsChart" width="400" height="150"></canvas>';
            courtsUsageElement.innerHTML = html;
            
            // Aquí iría el código para generar el gráfico
            // En una implementación real, usarías una librería como Chart.js
          } else {
            courtsUsageElement.innerHTML = '<p>No hay datos de uso de canchas en la última semana</p>';
          }
        }
      } catch (error) {
        console.error("Error crítico al cargar dashboard:", error);
        const topPlayersList = document.getElementById('top-players-list');
        const courtsUsage = document.getElementById('courts-usage');
        
        if (topPlayersList) topPlayersList.innerHTML = '<p>Error al cargar el ranking</p>';
        if (courtsUsage) courtsUsage.innerHTML = '<p>Error al cargar el uso de canchas</p>';
      }
    };
  </script>
</body>
</html>